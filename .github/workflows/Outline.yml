name: Convert LaTeX to HTML

on:
  push:
    branches:
      - main

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Outline repository
        uses: actions/checkout@v3
        with:
          repository: tomoto0/Outline
          path: Outline

      - name: Checkout tomoto0.github.io repository
        uses: actions/checkout@v3
        with:
          repository: tomoto0/tomoto0.github.io
          path: tomoto0.github.io

      - name: Install pandoc
        run: sudo apt-get install -y pandoc

      - name: Convert LaTeX to HTML
        run: |
          pandoc ./Outline/Outline.tex -o outline_temp.html \
            --standalone \
            --mathjax \
            --css=https://latex.vercel.app/style.css \
            --highlight-style=pygments

      - name: Add additional CSS and scripts
        run: |
          cat <<'EOF' > ./tomoto0.github.io/outline.html
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Research Outline</title>
            <link rel="stylesheet" href="https://latex.vercel.app/style.css">
            <link rel="stylesheet" href="https://latex.vercel.app/prism/prism.css">
            <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/prismjs/prism.min.js"></script>
            <a href="Outline.pdf" download>
              <button class="w3-button w3-light-grey w3-padding-large w3-margin-top">
                <i class="fa fa-download"></i> Download Resume
              </button>
            </a>
          </head>
          <body class="latex-dark-auto">
          EOF
          
          cat outline_temp.html >> ./tomoto0.github.io/outline.html
          
          cat <<'EOF' >> ./tomoto0.github.io/outline.html
          <script>
            MathJax = {
              tex: {
                inlineMath: [['$', '$'],],
              },
            };
          </script>
          </body>
          </html>
          EOF
          
          rm outline_temp.html

      - name: Commit and push changes
        run: |
          cd ./tomoto0.github.io
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add outline.html
          git commit -m 'Convert LaTeX to HTML with improved styling'
          git push
    env:
      GITHUB_TOKEN: ${{ secrets.PAT_FOR_OUTLINE_REPO }}
